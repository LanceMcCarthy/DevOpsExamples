name: ASP.NET AJAX

on:
  workflow_dispatch:
  push:
    branches:
      - main
      - "ajax/*"
    paths:
      - 'src/Ajax/**/*'
      - '.github/workflows/main_build-ajax.yml' 

jobs:
  build_web_app:
    runs-on: windows-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup Nuget.exe 
      uses: nuget/setup-nuget@v2

    - name: Setup MSBuild.exe
      uses: microsoft/setup-msbuild@v1.3.2
    
    # We are using nuget.exe to restore the nuget packages before using msbuild. See https://docs.microsoft.com/en-us/nuget/reference/nuget-exe-cli-reference
    # The environment variables are used in the nuget.config file, for more information see https://github.com/LanceMcCarthy/DevOpsExamples#github-actions-using-secrets-to-set-environment-variables
    - name: NuGet.exe Restore
      run: nuget restore src\Ajax\MySite.sln -ConfigFile src\NuGet.Config
      env:
        TELERIK_USERNAME: "api-key"
        TELERIK_PASSWORD: ${{secrets.TELERIK_NUGET_KEY}}

    - name: Build the AJAX application
      run: msbuild src\Ajax\MySite.sln /t:Restore /p:Configuration=Release /p:RuntimeIdentifier=any
